window.addEventListener("DOMContentLoaded",function(){"use strict";if((async()=>{const e=await(async(e,t="GET",r=null,c={"Content-Type":"application/json"})=>{try{const n=await fetch(e,{method:t,body:r,headers:c});return!0===n.ok?await n.json():!1}catch(e){console.error(e)}})("https://630a4bf0f280658a59cd0ad1.mockapi.io/goods");console.log(e);let t=document.querySelector(".cards");var r=e.map(e=>{return{title:e,id:t,img:r,price:c,classfilter:n,popular:l,newfilter:o}=[e][0],`
      <div class="card cardId ${n}" data-id="${t}" data-sort="${c}" data-popular="${l}" data-new="${o}" data-filter="${n}">
        <div class="card__image-block"><img class="card__image" src="./images/cards/${r}.png" alt="${e}" /></div>
        <div class="card__content-block">
          <h3 class="card__title">${e}</h3>
          <div class="card__price">${c} ₽</div>
          <div class="card__btn-position">
            <button class="card__btn btnAdd"></button>
          </div>
        </div>
      </div>
    `;var t,r,c,n,l,o});t.innerHTML=r;const c=document.querySelectorAll(".card__btn"),d=document.querySelector(".cart__body-cards");document.querySelector(".cart");const n=document.querySelector(".cart-count"),l=document.querySelector(".totalCount");let i=0;const a=e=>e.replace(/\s/g,""),s=e=>String(e).replace(/(\d)(?=(\d\d\d)+([^\d]|$))/g,"$1 "),u=()=>{l.textContent=s(i)+" ₽"},y=()=>{var e=d.children.length;n.textContent=e},o=e=>{var t=e.querySelector(".cart__item-img").dataset.id,t=(console.log(t),parseInt(a(e.querySelector(".cart__item-price").textContent)));t=t,i-=t,u(),e.remove(),y()};c.forEach(e=>{e.addEventListener("click",e=>{let t=e.currentTarget,r=t.closest(".card");var c,e=r.dataset.id,n=r.querySelector("img").getAttribute("src"),l=r.querySelector(".card__title").innerText,o=parseInt(a(r.querySelector(".card__price").innerText));c=o,i+=c,u(),d.insertAdjacentHTML("afterbegin",(c=o,`
      <div class="cart__item">
        <img class="cart__item-img" src="${n}" alt="image" data-id="${e}" />
        <div class="cart__item-descr">
            <h4 class="cart__item-descr-title">${l}</h4>
            <div class="cart__item-price">${s(c)} ₽</div>
        </div>
        <div class="cart__item-buttons">
          <button class="btn-minus"></button>
          <span>2</span>
          <button class="btn-plus"></button>
        </div>
        <button class="btn-remove"></button>
        <button class="btn-restore"></button>
    </div>
      `)),y()})}),d.addEventListener("click",e=>{e.target.classList.contains("btn-remove")&&o(e.target.closest(".cart__item"))});r=document.querySelectorAll(".card");document.querySelector(".card-count").innerHTML=r.length+" товаров",v()})(),window.NodeList&&!NodeList.prototype.forEach){thisArg=thisArg||window;for(let e=0;e<this.length;e++)callback.call(thisArg,this[e],e,this)}document.querySelectorAll(".dropdown").forEach(function(e){const t=e.querySelector(".dropdown__button"),r=e.querySelector(".dropdown__list"),c=e.querySelector(".dropdown__list-wrap"),n=r.querySelectorAll(".dropdown__list-item"),l=e.querySelector(".dropdown__input");t.addEventListener("click",function(e){e.preventDefault(),r.classList.toggle("dropdown__list--visible"),t.style.display="none",c.style.display="block",document.body.style.overflow="hidden"}),n.forEach(e=>{e.addEventListener("click",function(e){e.stopPropagation(),t.innerText=this.innerText,l.value=this.dataset.value,r.classList.remove("dropdown__list--visible"),document.body.style.overflow="visible",c.style.display="none",t.style.display="block"})}),document.addEventListener("click",function(e){e.target!==t&&(r.classList.remove("dropdown__list--visible"),document.body.style.overflow="visible",c.style.display="none",t.style.display="block")}),document.addEventListener("keydown",function(e){"Tab"!==e.key&&"Escape"!==e.key||(r.classList.remove("dropdown__list--visible"),document.body.style.overflow="visible",c.style.display="none",t.style.display="block")})}),document.querySelector('.dropdown__list-item[data-value="expensive"]').addEventListener("click",()=>{t("data-sort")}),document.querySelector('.dropdown__list-item[data-value="cheap"]').addEventListener("click",()=>{e("data-sort")}),document.querySelector('.dropdown__list-item[data-value="popular"]').addEventListener("click",()=>{r("data-popular")}),document.querySelector('.dropdown__list-item[data-value="new"]').addEventListener("click",()=>{r("data-new")});const e=r=>{let c=document.querySelector(".cards");for(let t=0;t<c.children.length;t++)for(let e=t;e<c.children.length;e++){var n;+c.children[t].getAttribute(r)>+c.children[e].getAttribute(r)&&(n=c.replaceChild(c.children[e],c.children[t]),l(n,c.children[t]))}},t=r=>{let c=document.querySelector(".cards");for(let t=0;t<c.children.length;t++)for(let e=t;e<c.children.length;e++){var n;+c.children[t].getAttribute(r)<+c.children[e].getAttribute(r)&&(n=c.replaceChild(c.children[e],c.children[t]),l(n,c.children[t]))}},r=r=>{let c=document.querySelector(".cards");for(let t=0;t<c.children.length;t++)for(let e=t;e<c.children.length;e++){var n;"true"!==c.children[t].getAttribute(r)&&(n=c.replaceChild(c.children[e],c.children[t]),l(n,c.children[t]))}},l=(e,t)=>t.parentNode.insertBefore(e,t.nextSibling),v=()=>{const r=document.querySelectorAll(".card");document.querySelector(".aside__filter-buttons").addEventListener("click",e=>{if(e.target.classList.contains(".toggle-button"))return!1;let t=e.target.getAttribute("data-filter");r.forEach(e=>{e.classList.remove("display-none"),e.classList.contains(t)||e.classList.add("display-none")})})};document.querySelector(".cartBtn").addEventListener("click",()=>{document.querySelector(".cart").style.display="block",document.body.style.overflow="hidden",document.querySelector(".btn-close").addEventListener("click",function(e){e.preventDefault(),document.querySelector(".cart").style.display="none",document.body.style.overflow="visible"})})});